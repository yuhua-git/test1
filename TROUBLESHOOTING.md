# 微信小程序故障排除指南

本文档提供了关于如何解决微信小程序开发中常见问题的指导，特别是关于API端口更改后的缓存问题。

## 端口更改问题

如果后端服务的端口从8000更改为8001，您可能会遇到以下问题：

1. 小程序仍然尝试连接到旧端口(8000)
2. 即使更新了`app.js`中的`apiBaseUrl`，请求仍然发送到旧端口
3. 控制台显示404错误：`http://localhost:8000/chat 404 (Not Found)`

## 解决方案

### 1. 清除微信开发者工具的缓存

微信开发者工具可能会缓存旧的配置和代码，导致更改不生效。请按照以下步骤清除缓存：

1. 在微信开发者工具中，点击顶部菜单栏的「工具」
2. 选择「清除缓存」
3. 在弹出的对话框中，选择「清除全部缓存」
4. 点击「确定」
5. 开发者工具将重启

### 2. 重新编译小程序

清除缓存后，您需要重新编译小程序：

1. 在微信开发者工具中，点击顶部菜单栏的「编译」按钮
2. 或者使用快捷键 Ctrl+B (Windows) 或 Command+B (Mac)

### 3. 检查全局配置是否正确加载

确认`app.js`中的全局配置已正确加载：

1. 在小程序的任意页面JS文件中（如`pages/index/index.js`），添加以下调试代码：

```javascript
onLoad: function() {
  const app = getApp()
  console.log('当前API基础URL:', app.globalData.apiBaseUrl)
  // 其他代码...
}
```

2. 查看控制台输出，确认显示的是正确的URL（应该是`http://localhost:8001`）

### 4. 检查网络请求

使用微信开发者工具的网络面板检查请求：

1. 在开发者工具中，点击底部的「调试器」
2. 选择「Network」标签
3. 在小程序中触发网络请求（例如发送聊天消息）
4. 观察请求的URL，确认它使用的是正确的端口(8001)

### 5. 重启后端服务

确保后端服务正确运行在端口8001上：

1. 停止所有运行在端口8000和8001上的服务
2. 使用更新后的启动脚本重新启动后端服务
3. 确认服务正在监听端口8001

## 其他可能的解决方案

如果上述步骤不能解决问题，请尝试：

1. **重新启动微信开发者工具**：完全关闭并重新打开开发者工具
2. **重新导入项目**：关闭项目，然后重新导入
3. **检查代码中的硬编码URL**：搜索代码库中是否有硬编码的`localhost:8000`URL
4. **检查是否有多个后端服务**：确保没有多个服务同时运行在不同端口上

## 联系支持

如果您尝试了所有解决方案但问题仍然存在，请联系技术支持团队，并提供以下信息：

1. 错误消息的截图
2. 微信开发者工具的版本
3. 您尝试过的解决方案
4. 后端服务的运行状态