# 微信小程序API调试指南

本文档提供了关于如何使用内置调试工具来解决微信小程序API请求问题的指导，特别是针对端口从8000更改为8001后可能出现的问题。

## 问题背景

后端服务的端口已从8000更改为8001，但小程序可能仍然尝试连接到旧端口，导致API请求失败。这通常是由于以下原因：

1. 微信开发者工具的缓存问题
2. 代码中硬编码的URL没有更新
3. 全局配置没有正确加载

## 使用内置调试工具

我们已经在小程序中添加了调试功能，可以帮助您诊断和解决API请求问题。

### 方法1：查看控制台输出

当小程序启动时，会自动在控制台输出API配置信息：

1. 在微信开发者工具中，点击底部的「调试器」
2. 选择「Console」标签
3. 查看输出的API基础URL信息
4. 确认显示的是正确的URL（应该是`http://localhost:8001`）

### 方法2：运行完整调试

您可以在控制台中运行完整的调试检查：

1. 在微信开发者工具中，点击底部的「调试器」
2. 选择「Console」标签
3. 输入以下命令并按回车：
   ```
   Page.instance.debugApi()
   ```
4. 查看控制台输出的调试信息，包括：
   - 当前API基础URL配置
   - 测试请求结果
   - 潜在问题的诊断

## 解决常见问题

### 如果调试显示API基础URL仍然使用旧端口(8000)

1. 检查`app.js`文件中的`globalData.apiBaseUrl`配置
2. 确保它设置为`http://localhost:8001`
3. 保存文件并重新编译小程序

### 如果请求到正确端口(8001)失败，但请求到旧端口(8000)成功

这表明可能有多个后端服务同时运行在不同端口上：

1. 检查运行中的后端服务
2. 停止所有运行在端口8000上的服务
3. 确保只有一个服务运行在端口8001上

### 如果两个端口的请求都失败

1. 确认后端服务正在运行
2. 运行`check_network.py`检查网络连接
3. 检查防火墙设置

## 清除缓存和重新加载

如果问题仍然存在，请尝试清除微信开发者工具的缓存：

1. 在微信开发者工具中，点击顶部菜单栏的「工具」
2. 选择「清除缓存」
3. 在弹出的对话框中，选择「清除全部缓存」
4. 点击「确定」
5. 开发者工具将重启
6. 重新编译小程序

## 其他资源

- 查看`TROUBLESHOOTING.md`获取更多故障排除指南
- 查看`LOCAL_SERVICE_GUIDE.md`获取本地服务配置指南